---
title: "Risk Maps"
author: "Anna Boser"
date: "1/29/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(here)
library(lubridate)
library(stringr)
library(raster)
```


### Figure 2 - Mordecai equation plot
```{r moredecai, echo=FALSE, warning=FALSE}
T = c(seq(0,100,by=0.1))
mordecai <- data.frame(temperature = T)

coef = 100

ggplot(mordecai, aes(x = temperature)) +
  stat_function(aes(col = "Biting rate"), 
                fun = function(x){(1.67*10^-4) * x * (x- 2.3) * (32.0 - x)^(1/2) * coef}, show.legend = TRUE) + #bite x 100
  stat_function(aes(col = "Transmission probability"), 
                fun = function(x){-(2.94*10^-3) * x * (x - 11.3) * (x - 41.9)}, show.legend = TRUE) + #transmission
  xlim(0, 45) +
  scale_y_continuous(
    name = "Transmission probability",
    limits = c(0,30),
    sec.axis = sec_axis(~./coef, name="Biting rate")) + 
  theme(legend.title = element_blank()) + 
  labs(title = "Culex Tarsalis biting and West Nile Virus transmission rates by temperature", 
       subtitle = "From Mordecai et. al., 2019") + 
  xlab("Temperature (C)") 
```

### Figure 6 - Tx wrt time of day (land cover type)
```{r day_tiime_series, echo=FALSE, warning=FALSE}

```

### Figure 7 - maps for each time of day
```{r four_maps, echo=FALSE, warning=FALSE}
chosen_four <- list.files(here::here("risk_maps",
                                     "data", 
                                     "raw_data", 
                                     "ECOSTRESS", 
                                     "chosen_four"))

four_panel <- function(type, limits){
  date <- ymd(substr(chosen_four, 14, 23))
  hhmmss <- str_extract(chosen_four, regex('[0-9]{2}:{1}[0-9]{2}:{1}[0-9]{2}'))
  dt <- ymd_hms(paste(date, hhmmss), tz = "America/Los_Angeles")
  
  night <- raster(here::here("risk_maps",
                                     "data", 
                                     "processed_data", 
                                     "ECOSTRESS", 
                                     type, 
                                     chosen_four[1]))
  dawn <- raster(here::here("risk_maps",
                                     "data", 
                                     "processed_data", 
                                     "ECOSTRESS", 
                                     type, 
                                     chosen_four[2]))
  day <- raster(here::here("risk_maps",
                                     "data", 
                                     "processed_data", 
                                     "ECOSTRESS", 
                                     type, 
                                     chosen_four[3]))
  dusk <- raster(here::here("risk_maps",
                                     "data", 
                                     "processed_data", 
                                     "ECOSTRESS", 
                                     type, 
                                     chosen_four[4]))
  
  # pal <- colorRampPalette(c("blue", "white", "red"))
  # pal <- colorRampPalette(c("blue", "green2", "yellow", "orange", "red"))
  pal <- colorRampPalette(c("darkblue", "blue", "steelblue1", "white", "yellow", "orange", "red"))
  
  plot(dawn, 
       col = pal(50), 
       # xlim=c(0,55),
       # ylim=c(-10,50),
       zlim=limits,
       xlab="Longitude", 
       ylab = "Latitude")
  title(paste0("Dawn (", dt[2],")"))
  
  plot(day, 
       col = pal(50), 
       # xlim=c(0,55),
       # ylim=c(-10,50),
       zlim=limits,
       xlab="Longitude", 
       ylab = "Latitude")
  title(paste0("Day (", dt[3],")"))
  
  plot(dusk, 
       col = pal(50), 
       # xlim=c(0,55),
       # ylim=c(-10,50),
       zlim=limits,
       xlab="Longitude", 
       ylab = "Latitude")
  title(paste0("Dusk (", dt[4],")"))
  
  plot(night, 
       col = pal(50), 
       # xlim=c(0,55),
       # ylim=c(-10,50),
       zlim=limits,
       xlab="Longitude", 
       ylab = "Latitude")
  title(paste0("Night (", dt[1],")"))
}
```

#### Air Temperature
```{r temp_maps, echo = FALSE}
four_panel("air_temperature", limits = c(12,38))
```

#### Biting rates
```{r b_maps, echo = FALSE}
four_panel("biting_rates", limits = c(0,.27))
```

#### transmission rates
```{r tx_maps, echo = FALSE}
four_panel("transmission_rates", limits = c(0,20))
```

### Figure 8 - statistical illustration showing breakdown by land cover

* Different ag types vs urban
* Heterogeneity within urban
* Veg continuous vs risk

```{r lst_scatter, echo=FALSE, warning=FALSE}

```